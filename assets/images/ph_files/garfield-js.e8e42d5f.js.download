var e;e=function(){"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}var e,t;(t=e=e||{}).CREATE="create",t.SEND="send",t.SET="set",t.REMOVE="remove";function d(){}var n,a=e,i=function(){function Tracker(e,t){this._id=e,this._name=t,this._screenResolution="",this._screenColorDepth="",this._screenWidth=0,this._screenHeight=0,this._referer="",this._pageUrl="",this._isTest=!1}var e=Tracker.prototype;return e.toJSON=function(){return{screenResolution:this._screenResolution,screenColorDepth:this._screenColorDepth,screenWidth:this._screenWidth,screenHeight:this._screenHeight,referer:this._referer,pageUrl:this._pageUrl,trackerId:this._id}},e.getId=function(){return this._id},e.getTrackerName=function(){return this._name},e.isTest=function(){return this._isTest},e.setScreenResolution=function(e){this._screenResolution=e},e.setScreenColorDepth=function(e){this._screenColorDepth=e},e.setScreenWidth=function(e){this._screenWidth=e},e.setScreenHeight=function(e){this._screenHeight=e},e.setTest=function(e){this._isTest=e},e.setPageUrl=function(e){this._pageUrl=e},e.setReferer=function(e){this._referer=e},Tracker}(),c=function(n){function CreateTrackerCommand(e){var t=n.call(this)||this;return t._options=e,t}_inheritsLoose(CreateTrackerCommand,n);var e=CreateTrackerCommand.prototype;return e.getScreenResolution=function(){return window.screen.width+"x"+window.screen.height},e.getViewportSize=function(){var e=document.documentElement,t=document.body,n=t&&t.clientWidth&&t.clientHeight,i=[];return e&&e.clientWidth&&e.clientHeight&&("CSS1Compat"===document.compatMode||!n)?i=[e.clientWidth,e.clientHeight]:n&&(i=[t.clientWidth,t.clientHeight]),i},e.getScreenColorDepth=function(){return window.screen.colorDepth+"-bit"},e.getIngestionType=function(){return this._options.ingestionType},e.execute=function(e){var t=new i(this._options.id,this._options.name);t.setScreenResolution(this.getScreenResolution());var n=this.getViewportSize();t.setScreenWidth(n[0]),t.setScreenHeight(n[1]),t.setScreenColorDepth(this.getScreenColorDepth()),this._options.doneCallback&&this._options.doneCallback(t),this._options.test&&t.setTest(!0),e(t)},CreateTrackerCommand}(d),o=function(){function CommandQueue(e){var t=this;this.dequeue=function(){return!t.isEmpty()&&t._commands.shift()},this.dequeueAndProcessNext=function(){t._state=3,t.dequeue()&&t.process()},this.clearAndResetInterval=function(){window.clearTimeout(t._setTimeoutId),t._setTimeoutId=0},this.process=function(){t.clearAndResetInterval(),0==t._commands.length?(t._state=1,t._flushCallback()):(t._state=2,t._commands[0]&&t._commands[0].execute(t.dequeueAndProcessNext))},this._commands=[],this._state=0,this._flushCallback=e,this._intervalTimeOut=1e3,this._setTimeoutId=0}var e=CommandQueue.prototype;return e.isEmpty=function(){return 0===this._commands.length},e.enqueue=function(e){var t=this;this._commands.push(e),2!==this._state&&0!==this._state&&("BATCH"===e.getIngestionType()?this._setTimeoutId||(this._setTimeoutId=window.setTimeout(function(){t.process()},this._intervalTimeOut)):this.process())},CommandQueue}(),s=function(){function GAEvent(e,t,n){this._eventLabel=e,this._eventType=t,this._eventValue=n,this._timestamp=Date.now()}return GAEvent.prototype.toJSON=function(){return{eventName:this._eventLabel,type:this._eventType,value:this._eventValue,timestamp:this._timestamp}},GAEvent}(),r=((n={}).pageview="PageView",n.click="Click",n.error="Error",n.custom="Custom",n),u=["click","custom","error","pageview"],h=["BATCH","IMMEDIATE"],l=function(n){function SendEventCommand(e){var t=n.call(this)||this;return t._options=e,t._validate(e)&&(t._options=_extends({eventName:r[e.eventType],value:document.title},e)),t}_inheritsLoose(SendEventCommand,n);var e=SendEventCommand.prototype;return e._validate=function(e){if(u.indexOf(e.eventType)<0)throw Error("Event "+e.eventType+" is not supported");if(h.indexOf(e.ingestionType)<0)throw Error("Ingestion type "+e.ingestionType+" is not supported");switch(e.eventType){case"click":case"custom":case"error":if(!e.eventName||!e.value)throw Error("Event ("+e.eventType+"): eventName or value is missing. Skipping event logging");break;default:return!0}return!0},e.getIngestionType=function(){return this._options.ingestionType},e.execute=function(e){var t=this._options,n=t.eventType,i=t.eventName,o=t.value,r=new s(i,n,o);this._options.doneCallback&&this._options.doneCallback(r),e(r)},SendEventCommand}(d);var p,m,f,_=function(){function NetworkManager(e){var o=this;this._tenantId=e,this._callbackMapping={},window.JSNetworkBridge&&window.JSNetworkBridge.processRequest&&(window.PhonePe={},window.PhonePe.MessagingHandler={},window.PhonePe.MessagingHandler.callback=function(e,t,n,i){o._callbackMapping[e]&&o._callbackMapping[e](t,n,i)})}var e=NetworkManager.prototype;return e.updateCallbackMapping=function(e,t){this._callbackMapping[e]=t},e.sendXHR=function(n){var i=new XMLHttpRequest;i.withCredentials=!0,i.open(n.method,n.url,!0),i.setRequestHeader("Content-Type","application/json"),n.headers&&(delete n.headers.cookie,delete n.headers.origin),n.headers&&Object.keys(n.headers).map(function(e){var t=(null==n?void 0:n.headers)&&(null==n?void 0:n.headers[e])||"";i.setRequestHeader(e,t)}),i.onreadystatechange=function(){this.readyState!==XMLHttpRequest.DONE||200!==this.status&&204!==this.status||n.cb&&n.cb()},"POST"==n.method?i.send(JSON.stringify(n.requestBody)):i.send()},e.sendBridgeRequest=function(e){var t={baseUrl:e.baseUrl,subUrl:e.subUrl,httpMethod:e.method,headers:e.headers,bodyJSON:JSON.stringify(e.requestBody),"content-type":"application/json",callbackId:e.callbackId};window.JSNetworkBridge.processRequest(JSON.stringify(t))},e.send=function(e){window.JSNetworkBridge&&window.JSNetworkBridge.processRequest?(e.callbackId&&e.callbackFn&&this.updateCallbackMapping(e.callbackId,e.callbackFn),this.sendBridgeRequest(e)):this.sendXHR(e)},e.initClient=function(i){var e=1e9*Math.random(),t={url:"https://api.phonepe.com/apis/garfield/v1/init/"+this._tenantId,baseUrl:"https://api.phonepe.com/apis/garfield/v1",subUrl:"bridge/init/"+this._tenantId,method:"POST",cb:i,headers:{cookie:document.cookie,origin:window.location.origin,"X-NAMESPACE-ID":this._tenantId},callbackFn:function(e,t){var n;void 0===t&&(t=""),"1"===e&&(((n=JSON.parse(atob(t))).headers&&n.headers["set-cookie"]||[]).forEach(function(e){document.cookie=e}),i&&i())},callbackId:e};this.send(t)},e.processAndSend=function(e,t){e.setPageUrl(window.location.protocol+"//"+window.location.hostname+window.location.pathname),e.setReferer(document.referrer);var n={};e.isTest()&&(n={"X-TESTING_ENABLED":"true"});var i={url:"https://api.phonepe.com/apis/garfield/v1/ingest",baseUrl:"https://api.phonepe.com/apis/garfield/v1",subUrl:"bridge/ingest",method:"POST",requestBody:_extends({},e.toJSON(),{events:t,namespaceId:this._tenantId}),headers:_extends({cookie:document.cookie,origin:window.location.origin,"X-NAMESPACE-ID":this._tenantId},n),"content-type":"application/json"};this.send(i)},NetworkManager}(),g=function(){function CommandManager(e){var i=this;this.start=function(){window.addEventListener("load",i.startProcessing)},this.addTracker=function(e){i._trackers.push(e),i._events[e.getId()]=[]},this.addEvent=function(e,t){var n=i.getDefaultTracker().getId();void 0!==t&&(n=t),i._events[n].push(e)},this.startProcessing=function(){i._commandQueue.process()},this.flushEvents=function(){for(var e in i._events)0<i._events[e].length&&(i._networkManager.processAndSend(i.getTrackerById(e),i._events[e].map(function(e){return e.toJSON()})),i._events[e]=[])},this._trackers=[],this._events={},this._commandQueue=new o(this.flushEvents),this._networkManager=new _(e),this._networkManager.initClient(this.startProcessing)}var e=CommandManager.prototype;return e.getDefaultTracker=function(){return this._trackers[0]},e.getTrackerById=function(t){return this._trackers.filter(function(e){return e.getId()===t})[0]},e.queueCommand=function(e,t){switch(e.toLowerCase()){case a.CREATE:var n=_extends({doneCallback:this.addTracker},t),i=new c(n);this._commandQueue.enqueue(i);break;case a.SEND:var o,r=e.split("."),s=this.addEvent;if(1<r.length&&(o=r[0],s=function(i){for(var e=arguments.length,o=new Array(1<e?e-1:0),t=1;t<e;t++)o[t-1]=arguments[t];return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.apply(void 0,t.concat(o))}}(this.addEvent,o)),t.eventType)try{i=new l(_extends({ingestionType:"BATCH"},t,{doneCallback:s})),this._commandQueue.enqueue(i)}catch(e){}}},CommandManager}(),v=function(){function GarfieldClient(e){this._commandManager=new g(e)}return GarfieldClient.prototype.executeCommand=function(e,t){var n={};switch(e.toLowerCase()){case a.CREATE:if("string"==typeof t)n.id=t;else if(!("id"in t))throw new Error("Missing field 'id' not sent while creating a Tracker");n=t,this._commandManager.queueCommand(a.CREATE,n);break;case a.SEND:"string"==typeof t?n.eventType=t:n=t,this._commandManager.queueCommand(a.SEND,n)}},GarfieldClient}();p=window.GaNamespaceId,m=new v(p),f=window.GarfieldObjName,window[f].q.map(function(e){m.executeCommand.apply(m,e)}),window[f]=function(e,t){m.executeCommand.call(m,e,t)}},"function"==typeof define&&define.amd?define(e):e();
